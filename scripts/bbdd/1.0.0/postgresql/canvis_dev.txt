

ALTER TABLE dib_infocustody RENAME custodyfileid  TO custodyid;


ALTER TABLE dib_transaccio
  ADD COLUMN nom character varying(255);
COMMENT ON COLUMN dib_transaccio.nom IS 'Nom descriptiu de la transaccio';

ALTER TABLE dib_configuraciofirma
  ADD COLUMN pluginfirmaservidorid bigint NOT NULL;
ALTER TABLE dib_configuraciofirma
  ADD CONSTRAINT dib_conffirma_plugin_fir_fk FOREIGN KEY (pluginfirmaservidorid) REFERENCES dib_plugin (pluginid) ON UPDATE NO ACTION ON DELETE NO ACTION;

ALTER TABLE dib_perfil
  ADD COLUMN utilitzatperaplicacio boolean;
  
  UPDATE dib_perfil
   SET utilitzatperaplicacio=false
 WHERE utilitzatperaplicacio is NULL AND usperfil < 0;
  
  create index dib_conffirma_plugfirma_fk_i on dib_configuraciofirma (pluginfirmaservidorid);
  
  

ALTER TABLE dib_configuraciogrup ADD COLUMN perfilnomesescaneig2id bigint;
ALTER TABLE dib_configuraciogrup ADD COLUMN perfilcopiaautentica2id bigint;
ALTER TABLE dib_configuraciogrup ADD COLUMN perfilcustodia2id bigint;

ALTER TABLE dib_configuraciogrup
  ADD CONSTRAINT dib_cfggrup_perfil_coau2_fk FOREIGN KEY (perfilcopiaautentica2id)
      REFERENCES dib_perfil (perfilid) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE dib_configuraciogrup
  ADD CONSTRAINT dib_cfggrup_perfil_cust2_fk FOREIGN KEY (perfilcustodia2id)
      REFERENCES dib_perfil (perfilid) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE dib_configuraciogrup
  ADD CONSTRAINT dib_cfggrup_perfil_scan2_fk FOREIGN KEY (perfilnomesescaneig2id)
      REFERENCES dib_perfil (perfilid) MATCH SIMPLE
      ON UPDATE NO ACTION ON DELETE NO ACTION;

CREATE INDEX dib_cfggrup_perfilcoau2_fk_i
  ON dib_configuraciogrup
  USING btree
  (perfilcopiaautentica2id);



CREATE INDEX dib_cfggrup_perfilcust2_fk_i
  ON dib_configuraciogrup
  USING btree
  (perfilcustodia2id);



CREATE INDEX dib_cfggrup_perfilscan2_fk_i
  ON dib_configuraciogrup
  USING btree
  (perfilnomesescaneig2id);
  


